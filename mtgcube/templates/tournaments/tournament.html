{% extends "tournaments/base.html" %}
{% load tournament_utils %}

{% block javascript %}
<script>
    function fetchGameDetails() {
        fetch("{% url 'tournaments:current_match' tournament.id %}")
        .then(response => response.json())
        .then(data => {
            const gameDetailsElement = document.getElementById('game-info');
            if (data.error) {
                gameDetailsElement.textContent = `Could not retrieve game`;
            } else {
                gameDetailsElement.innerHTML = `
                    My current match: Table ${data.table}: ${data.player1} vs ${data.player2}</a>`;
            }
        })
        .catch(error => console.error('Error fetching game result for user:', error));
    }

    // Initial formatting
    document.addEventListener('DOMContentLoaded', () => {
        fetchGameDetails();
        setInterval(fetchGameDetails, 10000);
    });
</script>

{% endblock %}

{% block content %}
<div class="event-dashboard">
    <h1>Event Dashboard - {{ tournament.name }}</h1>
    
    <div id="draft-info">
        {% with cube=draft|get_item:'cube' %}
            {% with phase=draft|get_item:'phase' %}
                {% with cube_url=draft|get_item:'cube_url' %}
                    {% with draftid=draft|get_item:'id' %}
                        <h3>
                            <a href="{% url 'tournaments:current_draft_view' tournament.id draftid %}">
                                My Current Draft:
                            </a>
                        </h3> Phase {{ phase }} - Cube: 
                    {% endwith %}
                    <a href="{{ cube_url }}">{{ cube }}</a>
                {% endwith %}
            {% endwith %}
        {% endwith %}
    </div>
    <div id="game-info">
        My Current Match:
    </div>
</div>
{% endblock %}