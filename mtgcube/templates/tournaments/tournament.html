{% extends "tournaments/base.html" %}

{% block javascript %}
<script>
    function fetchGameDetails() {
        fetch("{% url 'tournaments:current_game' tournament.id %}")
        .then(response => response.json())
        .then(data => {
            const gameDetailsElement = document.getElementById('game-info');
            if (data.error) {
                gameDetailsElement.textContent = `Could not retrieve game`;
            } else {
                const game = data.current_game;
                gameDetailsElement.innerHTML = `
                    <a href="{% url 'tournaments:my_current_match' tournament.id %}">Table ${game.table}: ${game.player1} vs ${game.player2}</a>`;
            }
        })
        .catch(error => console.error('Error fetching game result for user:', error));
    }

    // Initial formatting
    document.addEventListener('DOMContentLoaded', () => {        
        fetchGameDetails();
        setInterval(updateTimer, 1000);
        setInterval(fetchGameDetails, 10000);
    });
</script>

{% endblock %}

{% block content %}
    <h1>Tournament Overview Page - {{ tournament.name }}</h1>
    
    <p> Rounds: {{ tournament.round_number }} (Currently in round {{ tournament.current_round }}) </p>
    
    My Current Match:
    <div id="game-info"></div>

    <a href="{% url 'tournaments:standings' tournament.id %}">Standings</a>

{% endblock %}